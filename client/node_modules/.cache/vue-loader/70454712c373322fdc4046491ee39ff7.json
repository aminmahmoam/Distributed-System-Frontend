{"remainingRequest":"/Users/aminmahmoudi/Desktop/DIT356/client 2/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/aminmahmoudi/Desktop/DIT356/client 2/client/src/views/Bookings.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/aminmahmoudi/Desktop/DIT356/client 2/client/src/views/Bookings.vue","mtime":1671800748226},{"path":"/Users/aminmahmoudi/Desktop/DIT356/client 2/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/aminmahmoudi/Desktop/DIT356/client 2/client/node_modules/vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBib29rIGZyb20gJy4uL2NvbXBvbmVudHMvQm9vay52dWUnCmltcG9ydCBtcXR0IGZyb20gJy4uL01RVFQnCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7IGJvb2sgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbWVzc2FnZTogJ25vbmUnLAogICAgICBib29raW5nczogW10sCiAgICAgIG5ld0Jvb2tpbmc6ICcnCiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5nZXRBbGxCb29raW5ncygpCiAgfSwKICBtZXRob2RzOiB7CiAgICBwYXJzZUp3dCh0b2tlbikgewogICAgICBjb25zdCBiYXNlNjRVcmwgPSB0b2tlbi5zcGxpdCgnLicpWzFdCiAgICAgIGNvbnN0IGJhc2U2NCA9IGJhc2U2NFVybC5yZXBsYWNlKC8tL2csICcrJykucmVwbGFjZSgvXy9nLCAnLycpCiAgICAgIGNvbnN0IGpzb25QYXlsb2FkID0gZGVjb2RlVVJJQ29tcG9uZW50KHdpbmRvdy5hdG9iKGJhc2U2NCkuc3BsaXQoJycpLm1hcChmdW5jdGlvbiAoYykgewogICAgICAgIHJldHVybiAnJScgKyAoJzAwJyArIGMuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC0yKQogICAgICB9KS5qb2luKCcnKSkKICAgICAgbGV0IHVzZXIgPSBKU09OLnBhcnNlKGpzb25QYXlsb2FkKQogICAgICByZXR1cm4gdXNlcgoKICAgIH0sCiAgICBnZXRBbGxCb29raW5ncygpIHsKICAgICAgbGV0IHVzZXIgPSB0aGlzLnBhcnNlSnd0KGxvY2FsU3RvcmFnZS5sb2dpblRva2VuKQogICAgICBsZXQgZGF0YSA9IHsKICAgICAgICB0b2tlbjogbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xvZ2luVG9rZW4nKQogICAgICB9CiAgICAgIGxldCByZXN1bHQgPSBtcXR0KCdnZXQnLCBgL3VzZXJzLyR7dXNlci5faWR9L2Jvb2tpbmdzYCwgZGF0YSwgZmFsc2UpCiAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIGlmIChyZXN1bHRbMF0uZGF0YSA9PT0gJzQwMSB1bmF1dGhvcml6ZWQnKSB7CiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2xvZ2luVG9rZW4nKQogICAgICB9IGVsc2UgaWYgKHJlc3VsdFswXS5kYXRhLmJvb2tpbmdzKSB7CiAgICAgICAgdGhpcy5ib29raW5ncyA9IHJlc3VsdFswXS5kYXRhLmJvb2tpbmdzCiAgICAgIH0gZWxzZSB7CiAgICAgICAgYWxlcnQoJ1NvbWV0aGluZyB3ZW50IHdyb25nISBQbGFlc2UgdHJ5IGFnYWluIGxhdGVyLicpCiAgICAgIH0KICAgICAgICAKICAgICAgfSwgMTAwMCkKICAgIH0sCiAgICAvLyBUaGlzIG1ldGhvZCBpcyBvbmx5IGZvciB0aGUgc2FrZSBvZiBzYXZpbmcgYSBib29raW5nIGZvciBhIHVzZXIgYW5kIHRlc3QgaWYgaXQgaXMgc3RvcmVkIGluIHRoZSBkYXRhYmFzZQogICAgLy8gVGhpcyBtZXRob2Qgc2hvdWxkIHByb3BhYmx5IGJlIGluIHRoZSBCb29raW5zLnZ1ZSBwYWdlcwogICAgYWRkQm9va2luZygpIHsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgdGhpcy5uZXdCb29raW5nID0gewogICAgICAgICAgdXNlcklkOiAxMiwKICAgICAgICAgIHJldWVzdElkOiAxLAogICAgICAgICAgZGVudGlzdElkOiAxLAogICAgICAgICAgaXNzdWFuY2U6IDEsCiAgICAgICAgICBkYXRlOiAnMjAyMi0xMC0xMScKICAgICAgICB9CiAgICAgIH0sIDEwMDApCiAgICAgIGNvbnN0IHJlc3VsdCA9IG1xdHQoJ3Bvc3RCb29raW5nRm9yVXNlcicsICcvdXNlcnMvNjM5MWVkYmNkY2UxMTY3YzE5NGYyZTM1L2Jvb2tpbmdzJywgdGhpcy5uZXdCb29raW5nLCB0cnVlKQogICAgICBpZiAocmVzdWx0LnN0YXR1cyA9PT0gMjAxKSB7CiAgICAgICAgY29uc29sZS5sb2coJ3N1Y2Nlc2Z1bGwnKQogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKCd1bnN1Y2NzZXNmdWxsJykKICAgICAgfQogICAgfQogICAgCiAgfQp9Cg=="},{"version":3,"sources":["Bookings.vue"],"names":[],"mappings":";AA+BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"Bookings.vue","sourceRoot":"src/views","sourcesContent":["<template>\n    <!-- Booking history -->\n    <div>\n        <div class=\"map-body\">\n    <p style=\"color: #748FC4; font-style: bold;\" class=\"map-text\">MY BOOKINGS</p>\n  </div>\n    <div id=\"bookings-box\">\n        <div style=\"text-align: center; width: 100%;\" v-for=\"booking in bookings\" v-bind:key=\"booking\">\n          <div class=\"book-box\">\n          <b-row>\n            <b-col>\n                <h>Date: {{booking.date.substr(0,10)}}</h>\n            </b-col>\n            <b-col>\n                <h>Time: {{booking.time}}</h>\n            </b-col>\n            <b-col>\n                <h>Clinic: {{booking.clinicName}}</h>\n            </b-col>\n            <b-col>\n                <h>Dentist: Dentist{{booking.dentistId}}</h>\n            </b-col>\n        </b-row>\n          </div>\n\n        </div>\n    </div>\n</div>\n</template>\n\n<script>\nimport book from '../components/Book.vue'\nimport mqtt from '../MQTT'\nexport default {\n  components: { book },\n  data() {\n    return {\n      message: 'none',\n      bookings: [],\n      newBooking: ''\n    }\n  },\n  mounted() {\n    this.getAllBookings()\n  },\n  methods: {\n    parseJwt(token) {\n      const base64Url = token.split('.')[1]\n      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/')\n      const jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function (c) {\n        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)\n      }).join(''))\n      let user = JSON.parse(jsonPayload)\n      return user\n\n    },\n    getAllBookings() {\n      let user = this.parseJwt(localStorage.loginToken)\n      let data = {\n        token: localStorage.getItem('loginToken')\n      }\n      let result = mqtt('get', `/users/${user._id}/bookings`, data, false)\n      setTimeout(() => {\n        if (result[0].data === '401 unauthorized') {\n        localStorage.removeItem('loginToken')\n      } else if (result[0].data.bookings) {\n        this.bookings = result[0].data.bookings\n      } else {\n        alert('Something went wrong! Plaese try again later.')\n      }\n        \n      }, 1000)\n    },\n    // This method is only for the sake of saving a booking for a user and test if it is stored in the database\n    // This method should propably be in the Bookins.vue pages\n    addBooking() {\n      setTimeout(() => {\n        this.newBooking = {\n          userId: 12,\n          reuestId: 1,\n          dentistId: 1,\n          issuance: 1,\n          date: '2022-10-11'\n        }\n      }, 1000)\n      const result = mqtt('postBookingForUser', '/users/6391edbcdce1167c194f2e35/bookings', this.newBooking, true)\n      if (result.status === 201) {\n        console.log('succesfull')\n      } else {\n        console.log('unsuccsesfull')\n      }\n    }\n    \n  }\n}\n</script>\n\n<style>\n#bookings-box {\n    margin-top: 3rem;\n    box-sizing: border-box;\n    height: auto;\n    border-radius: 25px;\n    text-align: center;\n    margin-left: 18%;\n    margin-right: 18%;\n    background: #ffffff;\n    padding: 40px;\n    color: #748FC4;\n    box-shadow: 0px 4px 4px rgba(143, 145, 190, 0.25);\n    padding: 20px;\n}\n.book-box {\n    height: auto;\n    margin-top: 15px;\n    padding-top: 11px;\n    color:#748FC4;\n    background: #F0F5FF;\n    border-radius: 10px 10px 10px 10px;\n    box-sizing: border-box;\n    box-shadow: 0px 4px 4px rgba(143, 145, 190, 0.25);\n    padding-bottom: 3px;\n    margin-left: 1%;\n    margin-right: 1%;\n}\n</style>\n"]}]}